<div class="guest-house-master-container">
  <div class="header">
    <h2>Guest House Master</h2>
  </div>

  <!-- Step 1: Guest House -->
  <mat-card>
    <form [formGroup]="guestHouseForm">
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Guest House Name</mat-label>
          <input matInput formControlName="name" required>
          <mat-error *ngIf="guestHouseForm.get('name')?.hasError('required')">Name required</mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Address</mat-label>
          <input matInput formControlName="address" required>
          <mat-error *ngIf="guestHouseForm.get('address')?.hasError('required')">Address required</mat-error>
        </mat-form-field>
       
        <button mat-raised-button color="primary" class="action-btn"
                (click)="addGuestHouse()" [disabled]="!guestHouseForm.valid">
          Add Guest House
        </button>
      </div>
    </form>
  </mat-card>

  <!-- Add Room Section -->
  <mat-card style="margin-top: 20px;">
    <form [formGroup]="roomForm">
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Room Name</mat-label>
          <input matInput formControlName="name" required>
          <mat-error *ngIf="roomForm.get('name')?.hasError('required')">Room name required</mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Select Guest House</mat-label>
          <mat-select formControlName="guestHouseId" required (selectionChange)="onGuestHouseSelected($event)">
            <mat-option *ngFor="let gh of guestHouses" [value]="gh.id">{{gh.name}}</mat-option>
          </mat-select>
          <mat-error *ngIf="roomForm.get('guestHouseId')?.hasError('required')">Select guest house</mat-error>
        </mat-form-field>
        <button mat-raised-button color="primary" class="action-btn"
                (click)="addRoom()" [disabled]="!roomForm.valid">
          Add Room
        </button>
      </div>
    </form>
  </mat-card>

  <!-- Add Bed Section -->
  <mat-card style="margin-top: 20px;">
    <form [formGroup]="bedForm">
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Bed Number</mat-label>
          <input matInput formControlName="bedNumber" required>
          <mat-error *ngIf="bedForm.get('bedNumber')?.hasError('required')">Bed number required</mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Select Guest House</mat-label>
          <mat-select required (selectionChange)="onGuestHouseSelected($event)">
            <mat-option *ngFor="let gh of guestHouses" [value]="gh.id">{{gh.name}}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Select Room</mat-label>
          <mat-select formControlName="roomId" required>
            <mat-option *ngFor="let r of dropdownRooms" [value]="r.id">{{ r.name }}</mat-option>
          </mat-select>
          <mat-error *ngIf="bedForm.get('roomId')?.hasError('required')">Select room</mat-error>
        </mat-form-field>
        <button mat-raised-button color="primary" class="action-btn"
                (click)="addBed()" [disabled]="!bedForm.valid">
          Add Bed
        </button>
      </div>
    </form>
  </mat-card>

  <!-- Guest House Table -->
  <div class="table-container" style="margin-top:20px;">
    <h3>Guest Houses</h3>
    <table mat-table [dataSource]="guestHouseDataSource">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>Id</th>
        <td mat-cell *matCellDef="let elem">{{elem.id}}</td>
      </ng-container>
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let elem">{{elem.name}}</td>
      </ng-container>
      <ng-container matColumnDef="address">
        <th mat-header-cell *matHeaderCellDef>Address</th>
        <td mat-cell *matCellDef="let elem">{{elem.address}}</td>
      </ng-container>
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Delete</th>
        <td mat-cell *matCellDef="let elem">
          <button mat-icon-button class="delete-btn" (click)="confirmDeleteGuestHouse(elem.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedGuestHouseColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedGuestHouseColumns;"></tr>
    </table>
  </div>

  <!-- Room Table -->
  <div class="table-container" style="margin-top:20px;">
    <h3>Rooms</h3>
    <table mat-table [dataSource]="roomDataSource">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>Id</th>
        <td mat-cell *matCellDef="let elem">{{elem.id}}</td>
      </ng-container>
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let elem">{{elem.name}}</td>
      </ng-container>
      <ng-container matColumnDef="guestHouseId">
        <th mat-header-cell *matHeaderCellDef>Guest House</th>
        <td mat-cell *matCellDef="let elem">{{getGuestHouseNameById(elem.guestHouseId)}}</td>
      </ng-container>
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Delete</th>
        <td mat-cell *matCellDef="let elem">
          <button mat-icon-button class="delete-btn" (click)="confirmDeleteRoom(elem.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedRoomColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedRoomColumns;"></tr>
    </table>
  </div>

  <!-- Bed Table -->
  <div class="table-container" style="margin-top:20px;">
    <h3>Beds</h3>
    <table mat-table [dataSource]="bedDataSource">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>Id</th>
        <td mat-cell *matCellDef="let elem">{{elem.id}}</td>
      </ng-container>
      <ng-container matColumnDef="bedNumber">
        <th mat-header-cell *matHeaderCellDef>Bed Number</th>
        <td mat-cell *matCellDef="let elem">{{elem.bedNumber}}</td>
      </ng-container>
      <ng-container matColumnDef="roomId">
        <th mat-header-cell *matHeaderCellDef>Room</th>
        <td mat-cell *matCellDef="let elem">{{getRoomNameById(elem.roomId)}}</td>
      </ng-container>
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Delete</th>
        <td mat-cell *matCellDef="let elem">
          <button mat-icon-button class="delete-btn" (click)="confirmDeleteBed(elem.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedBedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedBedColumns;"></tr>
    </table>
  </div>

  <!-- Custom Confirmation Modal -->
  <div class="custom-modal-backdrop" *ngIf="modalOpen">
    <div class="custom-modal">
      <div class="custom-modal-title">Confirm</div>
      <div class="custom-modal-content">
        <p>{{ modalMessage }}</p>
      </div>
      <div class="custom-modal-actions">
        <button mat-button (click)="modalOpen=false">Cancel</button>
        <button mat-raised-button color="warn" (click)="modalConfirm()">Delete</button>
      </div>
    </div>
  </div>
</div>